var jsonata=function(){"use strict";var e={".":75,"[":80,"]":0,"{":70,"}":0,"(":80,")":0,",":0,"@":75,"#":70,";":80,":":80,"?":20,"+":50,"-":50,"*":60,"/":60,"%":60,"|":20,"=":40,"<":40,">":40,"^":40,"**":60,"..":20,":=":10,"!=":40,"<=":40,">=":40,"~>":40,and:30,or:25,in:40,"&":50,"!":0,"~":0},t={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},r=function(r){var n=0,i=r.length,a=function(e,t){return{type:e,value:t,position:n}};return function(o){if(n>=i)return null;for(var s=r.charAt(n);n<i&&" \t\n\r\v".indexOf(s)>-1;)n++,s=r.charAt(n);if(!0!==o&&"/"===s)return n++,a("regex",function(){for(var e,t,a=n,o=0;n<i;){var s=r.charAt(n);if("/"===s&&"\\"!==r.charAt(n-1)&&0===o){if(""===(e=r.substring(a,n)))throw{code:"S0301",stack:(new Error).stack,position:n};for(n++,s=r.charAt(n),a=n;"i"===s||"m"===s;)n++,s=r.charAt(n);return t=r.substring(a,n)+"g",new RegExp(e,t)}"("!==s&&"["!==s&&"{"!==s||"\\"===r.charAt(n-1)||o++,")"!==s&&"]"!==s&&"}"!==s||"\\"===r.charAt(n-1)||o--,n++}throw{code:"S0302",stack:(new Error).stack,position:n}}());if("."===s&&"."===r.charAt(n+1))return n+=2,a("operator","..");if(":"===s&&"="===r.charAt(n+1))return n+=2,a("operator",":=");if("!"===s&&"="===r.charAt(n+1))return n+=2,a("operator","!=");if(">"===s&&"="===r.charAt(n+1))return n+=2,a("operator",">=");if("<"===s&&"="===r.charAt(n+1))return n+=2,a("operator","<=");if("*"===s&&"*"===r.charAt(n+1))return n+=2,a("operator","**");if("~"===s&&">"===r.charAt(n+1))return n+=2,a("operator","~>");if(e.hasOwnProperty(s))return n++,a("operator",s);if('"'===s||"'"===s){var u=s;n++;for(var c="";n<i;){if("\\"===(s=r.charAt(n)))if(n++,s=r.charAt(n),t.hasOwnProperty(s))c+=t[s];else{if("u"!==s)throw{code:"S0103",stack:(new Error).stack,position:n,token:s};var f=r.substr(n+1,4);if(!/^[0-9a-fA-F]+$/.test(f))throw{code:"S0104",stack:(new Error).stack,position:n};var l=parseInt(f,16);c+=String.fromCharCode(l),n+=4}else{if(s===u)return n++,a("string",c);c+=s}n++}throw{code:"S0101",stack:(new Error).stack,position:n}}var p,d=/^-?(0|([1-9][0-9]*))(\.[0-9]+)?([Ee][-+]?[0-9]+)?/.exec(r.substring(n));if(null!==d){var h=parseFloat(d[0]);if(!isNaN(h)&&isFinite(h))return n+=d[0].length,a("number",h);throw{code:"S0102",stack:(new Error).stack,position:n,token:d[0]}}if("`"===s){n++;var v=r.indexOf("`",n);if(-1!==v)return p=r.substring(n,v),n=v+1,a("name",p);throw n=i,{code:"S0105",stack:(new Error).stack,position:n}}for(var g,y=n;;)if(g=r.charAt(y),y===i||" \t\n\r\v".indexOf(g)>-1||e.hasOwnProperty(g)){if("$"===r.charAt(n))return p=r.substring(n+1,y),n=y,a("variable",p);switch(p=r.substring(n,y),n=y,p){case"or":case"in":case"and":return a("operator",p);case"true":return a("value",!0);case"false":return a("value",!1);case"null":return a("value",null);default:return n===i&&""===p?null:a("name",p)}}else y++}};function n(e){for(var t=1,r=[],n={},i=n;t<e.length;){var a=e.charAt(t);if(":"===a)break;var o=function(){r.push(n),i=n,n={}},s=function(e,t,r,n){for(var i=1,o=t;o<e.length;)if(o++,(a=e.charAt(o))===n){if(0===--i)break}else a===r&&i++;return o};switch(a){case"s":case"n":case"b":case"l":case"o":n.regex="["+a+"m]",n.type=a,o();break;case"a":n.regex="[asnblfom]",n.type=a,n.array=!0,o();break;case"f":n.regex="f",n.type=a,o();break;case"j":n.regex="[asnblom]",n.type=a,o();break;case"x":n.regex="[asnblfom]",n.type=a,o();break;case"-":i.context=!0,i.contextRegex=new RegExp(i.regex),i.regex+="?";break;case"?":case"+":i.regex+=a;break;case"(":var u=s(e,t,"(",")"),c=e.substring(t+1,u);if(-1!==c.indexOf("<"))throw{code:"S0402",stack:(new Error).stack,value:c,offset:t};n.regex="["+c+"m]",n.type="("+c+")",t=u,o();break;case"<":if("a"!==i.type&&"f"!==i.type)throw{code:"S0401",stack:(new Error).stack,value:i.type,offset:t};var f=s(e,t,"<",">");i.subtype=e.substring(t+1,f),t=f}t++}var l="^"+r.map(function(e){return"("+e.regex+")"}).join("")+"$",p=new RegExp(l),d=function(e){var t;if(b(e))t="f";else switch(typeof e){case"string":t="s";break;case"number":t="n";break;case"boolean":t="b";break;case"object":t=null===e?"l":Array.isArray(e)?"a":"o";break;case"undefined":default:t="m"}return t};return{definition:e,validate:function(e,t){var n="";e.forEach(function(e){n+=d(e)});var i=p.exec(n);if(i){var a=[],o=0;return r.forEach(function(r,n){var s=e[o],u=i[n+1];if(""===u)if(r.context&&r.contextRegex){var c=d(t);if(!r.contextRegex.test(c))throw{code:"T0411",stack:(new Error).stack,value:t,index:o+1};a.push(t)}else a.push(s),o++;else u.split("").forEach(function(t){if("a"===r.type){if("m"===t)s=void 0;else{s=e[o];var n=!0;if(void 0!==r.subtype)if("a"!==t&&u!==r.subtype)n=!1;else if("a"===t&&s.length>0){var i=d(s[0]);if(i!==r.subtype.charAt(0))n=!1;else n=0===s.filter(function(e){return d(e)!==i}).length}if(!n)throw{code:"T0412",stack:(new Error).stack,value:s,index:o+1,type:r.subtype};"a"!==t&&(s=[s])}a.push(s),o++}else a.push(s),o++})}),a}!function(e,t){for(var n="^",i=0,a=0;a<r.length;a++){n+=r[a].regex;var o=t.match(n);if(null===o)throw{code:"T0410",stack:(new Error).stack,value:e[i],index:i+1};i=o[0].length}throw{code:"T0410",stack:(new Error).stack,value:e[i],index:i+1}}(e,n)}}}var i=function(t,i){var a,o,s={},u=[],c=function(){var e=[];"(end)"!==a.id&&e.push({type:a.type,value:a.value,position:a.position});for(var t=o();null!==t;)e.push(t),t=o();return e},f={nud:function(){var e={code:"S0211",token:this.value,position:this.position};if(i)return e.remaining=c(),e.type="error",u.push(e),e;throw e.stack=(new Error).stack,e}},l=function(e,t){var r=s[e];return t=t||0,r?t>=r.lbp&&(r.lbp=t):((r=Object.create(f)).id=r.value=e,r.lbp=t,s[e]=r),r},p=function(e){if(i){e.remaining=c(),u.push(e);var t=s["(error)"];return(a=Object.create(t)).error=e,a.type="(error)",a}throw e.stack=(new Error).stack,e},d=function(e,r){if(e&&a.id!==e){var n={code:"(end)"===a.id?"S0203":"S0202",position:a.position,token:a.value,value:e};return p(n)}var i=o(r);if(null===i)return(a=s["(end)"]).position=t.length,a;var u,c=i.value,f=i.type;switch(f){case"name":case"variable":u=s["(name)"];break;case"operator":if(!(u=s[c]))return p({code:"S0204",stack:(new Error).stack,position:i.position,token:c});break;case"string":case"number":case"value":u=s["(literal)"];break;case"regex":f="regex",u=s["(regex)"];break;default:return p({code:"S0205",stack:(new Error).stack,position:i.position,token:c})}return(a=Object.create(u)).value=c,a.type=f,a.position=i.position,a},h=function(e){var t,r=a;for(d(null,!0),t=r.nud();e<a.lbp;)r=a,d(),t=r.led(t);return t},v=function(e){l(e,0).nud=function(){return this}},g=function(t,r,n){var i=r||e[t],a=l(t,i);return a.led=n||function(e){return this.lhs=e,this.rhs=h(i),this.type="binary",this},a},y=function(e,t,r){var n=l(e,t);return n.led=r,n},b=function(e,t){var r=l(e);return r.nud=t||function(){return this.expression=h(70),this.type="unary",this},r};v("(end)"),v("(name)"),v("(literal)"),v("(regex)"),l(":"),l(";"),l(","),l(")"),l("]"),l("}"),l(".."),g("."),g("+"),g("-"),g("*"),g("/"),g("%"),g("="),g("<"),g(">"),g("!="),g("<="),g(">="),g("&"),g("and"),g("or"),g("in"),v("and"),v("or"),v("in"),b("-"),g("~>"),y("(error)",10,function(e){return this.lhs=e,this.error=a.error,this.remaining=c(),this.type="error",this}),b("*",function(){return this.type="wildcard",this}),b("**",function(){return this.type="descendant",this}),g("(",e["("],function(e){if(this.procedure=e,this.type="function",this.arguments=[],")"!==a.id)for(;"operator"===a.type&&"?"===a.id?(this.type="partial",this.arguments.push(a),d("?")):this.arguments.push(h(0)),","===a.id;)d(",");if(d(")",!0),"name"===e.type&&("function"===e.value||"Î»"===e.value)){if(this.arguments.forEach(function(e,t){if("variable"!==e.type)return p({code:"S0208",stack:(new Error).stack,position:e.position,token:e.value,value:t+1})}),this.type="lambda","<"===a.id){for(var t=a.position,r=1,i="<";r>0&&"{"!==a.id&&"(end)"!==a.id;){var o=d();">"===o.id?r--:"<"===o.id&&r++,i+=o.value}d(">");try{this.signature=n(i)}catch(e){return e.position=t+e.offset,p(e)}}d("{"),this.body=h(0),d("}")}return this}),b("(",function(){for(var e=[];")"!==a.id&&(e.push(h(0)),";"===a.id);)d(";");return d(")",!0),this.type="block",this.expressions=e,this}),b("[",function(){var e=[];if("]"!==a.id)for(;;){var t=h(0);if(".."===a.id){var r={type:"binary",value:"..",position:a.position,lhs:t};d(".."),r.rhs=h(0),t=r}if(e.push(t),","!==a.id)break;d(",")}return d("]",!0),this.expressions=e,this.type="unary",this}),g("[",e["["],function(t){if("]"===a.id){for(var r=t;r&&"binary"===r.type&&"["===r.value;)r=r.lhs;return r.keepArray=!0,d("]"),t}return this.lhs=t,this.rhs=h(e["]"]),this.type="binary",d("]",!0),this}),g("^",e["^"],function(e){d("(");for(var t=[];;){var r={descending:!1};if("<"===a.id?d("<"):">"===a.id&&(r.descending=!0,d(">")),r.expression=h(0),t.push(r),","!==a.id)break;d(",")}return d(")"),this.lhs=e,this.rhs=t,this.type="binary",this});var m=function(e){var t=[];if("}"!==a.id)for(;;){var r=h(0);d(":");var n=h(0);if(t.push([r,n]),","!==a.id)break;d(",")}return d("}",!0),void 0===e?(this.lhs=t,this.type="unary"):(this.lhs=e,this.rhs=t,this.type="binary"),this};b("{",m),g("{",e["{"],m),y(":=",e[":="],function(t){return"variable"!==t.type?p({code:"S0212",stack:(new Error).stack,position:t.position,token:t.value}):(this.lhs=t,this.rhs=h(e[":="]-1),this.type="binary",this)}),g("?",e["?"],function(e){return this.type="condition",this.condition=e,this.then=h(0),":"===a.id&&(d(":"),this.else=h(0)),this}),b("|",function(){return this.type="transform",this.pattern=h(0),d("|"),this.update=h(0),","===a.id&&(d(","),this.delete=h(0)),d("|"),this});var k=function(e){var t;if("function"!==e.type||e.predicate)if("condition"===e.type)e.then=k(e.then),void 0!==e.else&&(e.else=k(e.else)),t=e;else if("block"===e.type){var r=e.expressions.length;r>0&&(e.expressions[r-1]=k(e.expressions[r-1])),t=e}else t=e;else{var n={type:"lambda",thunk:!0,arguments:[],position:e.position};n.body=e,t=n}return t},x=function(e){var t;switch(e.type){case"binary":switch(e.value){case".":var r=x(e.lhs);t={type:"path",steps:[]},"path"===r.type?Array.prototype.push.apply(t.steps,r.steps):t.steps=[r];var n=x(e.rhs);"function"===n.type&&"path"===n.procedure.type&&1===n.procedure.steps.length&&"name"===n.procedure.steps[0].type&&"function"===t.steps[t.steps.length-1].type&&(t.steps[t.steps.length-1].nextFunction=n.procedure.steps[0].value),"path"!==n.type&&(n={type:"path",steps:[n]}),Array.prototype.push.apply(t.steps,n.steps),t.steps.filter(function(e){if("number"===e.type||"value"===e.type)throw{code:"S0213",stack:(new Error).stack,position:e.position,value:e.value};return"string"===e.type}).forEach(function(e){e.type="name"}),t.steps.filter(function(e){return!0===e.keepArray}).length>0&&(t.keepSingletonArray=!0);var a=t.steps[0];"unary"===a.type&&"["===a.value&&(a.consarray=!0);var o=t.steps[t.steps.length-1];"unary"===o.type&&"["===o.value&&(o.consarray=!0);break;case"[":var s=t=x(e.lhs);if("path"===t.type&&(s=t.steps[t.steps.length-1]),void 0!==s.group)throw{code:"S0209",stack:(new Error).stack,position:e.position};void 0===s.predicate&&(s.predicate=[]),s.predicate.push(x(e.rhs));break;case"{":if(void 0!==(t=x(e.lhs)).group)throw{code:"S0210",stack:(new Error).stack,position:e.position};t.group={lhs:e.rhs.map(function(e){return[x(e[0]),x(e[1])]}),position:e.position};break;case"^":(t={type:"sort",value:e.value,position:e.position,consarray:!0}).lhs=x(e.lhs),t.rhs=e.rhs.map(function(e){return{descending:e.descending,expression:x(e.expression)}});break;case":=":(t={type:"bind",value:e.value,position:e.position}).lhs=x(e.lhs),t.rhs=x(e.rhs);break;case"~>":(t={type:"apply",value:e.value,position:e.position}).lhs=x(e.lhs),t.rhs=x(e.rhs);break;default:(t={type:e.type,value:e.value,position:e.position}).lhs=x(e.lhs),t.rhs=x(e.rhs)}break;case"unary":t={type:e.type,value:e.value,position:e.position},"["===e.value?t.expressions=e.expressions.map(function(e){return x(e)}):"{"===e.value?t.lhs=e.lhs.map(function(e){return[x(e[0]),x(e[1])]}):(t.expression=x(e.expression),"-"===e.value&&"number"===t.expression.type&&((t=t.expression).value=-t.value));break;case"function":case"partial":(t={type:e.type,name:e.name,value:e.value,position:e.position}).arguments=e.arguments.map(function(e){return x(e)}),t.procedure=x(e.procedure);break;case"lambda":t={type:e.type,arguments:e.arguments,signature:e.signature,position:e.position};var c=x(e.body);t.body=k(c);break;case"condition":(t={type:e.type,position:e.position}).condition=x(e.condition),t.then=x(e.then),void 0!==e.else&&(t.else=x(e.else));break;case"transform":(t={type:e.type,position:e.position}).pattern=x(e.pattern),t.update=x(e.update),void 0!==e.delete&&(t.delete=x(e.delete));break;case"block":(t={type:e.type,position:e.position}).expressions=e.expressions.map(function(e){var r=x(e);return(r.consarray||"path"===r.type&&r.steps[0].consarray)&&(t.consarray=!0),r});break;case"name":t={type:"path",steps:[e]},e.keepArray&&(t.keepSingletonArray=!0);break;case"string":case"number":case"value":case"wildcard":case"descendant":case"variable":case"regex":t=e;break;case"operator":if("and"===e.value||"or"===e.value||"in"===e.value)e.type="name",t=x(e);else{if("?"!==e.value)throw{code:"S0201",stack:(new Error).stack,position:e.position,token:e.value};t=e}break;case"error":t=e,e.lhs&&(t=x(e.lhs));break;default:var f="S0206";"(end)"===e.id&&(f="S0207");var l={code:f,position:e.position,token:e.value};if(i)return u.push(l),{type:"error",error:l};throw l.stack=(new Error).stack,l}return t};o=r(t),d();var w=h(0);if("(end)"!==a.id){var A={code:"S0201",position:a.position,token:a.value};p(A)}return w=x(w),u.length>0&&(w.errors=u),w},a=I(null);function o(e){var t=!1;if("number"==typeof e&&(t=!isNaN(e))&&!isFinite(e))throw{code:"D1001",value:e,stack:(new Error).stack};return t}function s(e){var t=!1;return Array.isArray(e)&&(t=0===e.filter(function(e){return"string"!=typeof e}).length),t}function u(e){var t=!1;return Array.isArray(e)&&(t=0===e.filter(function(e){return!o(e)}).length),t}function*c(e,t,r){var n,i=r.lookup("__evaluate_entry");switch(i&&i(e,t,r),e.type){case"path":n=yield*function*(e,t,r){var n,i;n="variable"===e.steps[0].type?f(t):Array.isArray(t)?t:f(t);for(var a=0;a<e.steps.length;a++){var o=e.steps[a];if(0===a&&o.consarray?(i=yield*c(o,n,r),Array.isArray(i)||(i=f(i))):i=yield*p(o,n,r,a===e.steps.length-1),void 0===i||0===i.length)break;n=i}e.keepSingletonArray&&(i.keepSingleton=!0);return i}(e,t,r);break;case"binary":n=yield*function*(e,t,r){var n,i=yield*c(e.lhs,t,r),a=yield*c(e.rhs,t,r),s=e.value;try{switch(s){case"+":case"-":case"*":case"/":case"%":n=function(e,t,r){var n;if(void 0===e||void 0===t)return n;if(!o(e))throw{code:"T2001",stack:(new Error).stack,value:e};if(!o(t))throw{code:"T2002",stack:(new Error).stack,value:t};switch(r){case"+":n=e+t;break;case"-":n=e-t;break;case"*":n=e*t;break;case"/":n=e/t;break;case"%":n=e%t}return n}(i,a,s);break;case"=":case"!=":case"<":case"<=":case">":case">=":n=function(e,t,r){var n,i=typeof e,a=typeof t;if("undefined"===i||"undefined"===a)return!1;var o=function(){if("string"!==i&&"number"!==i||"string"!==a&&"number"!==a)throw{code:"T2010",stack:(new Error).stack,value:"string"!==i&&"number"!==i?e:t};if(i!==a)throw{code:"T2009",stack:(new Error).stack,value:e,value2:t}};switch(r){case"=":n=e===t;break;case"!=":n=e!==t;break;case"<":o(),n=e<t;break;case"<=":o(),n=e<=t;break;case">":o(),n=e>t;break;case">=":o(),n=e>=t}return n}(i,a,s);break;case"&":n=function(e,t){var r="",n="";void 0!==e&&(r=D(e));void 0!==t&&(n=D(t));return r.concat(n)}(i,a);break;case"and":case"or":n=function(e,t,r){var n;switch(r){case"and":n=M(e)&&M(t);break;case"or":n=M(e)||M(t)}return n}(i,a,s);break;case"..":n=function(e,t){var r;if(void 0===e||void 0===t)return r;if(e>t)return r;if(!Number.isInteger(e))throw{code:"T2003",stack:(new Error).stack,value:e};if(!Number.isInteger(t))throw{code:"T2004",stack:(new Error).stack,value:t};r=new Array(t-e+1);for(var n=e,i=0;n<=t;n++,i++)r[i]=n;return l(r)}(i,a);break;case"in":n=function(e,t){var r=!1;if(void 0===e||void 0===t)return!1;Array.isArray(t)||(t=[t]);for(var n=0;n<t.length;n++)if(t[n]===e){r=!0;break}return r}(i,a)}}catch(t){throw t.position=e.position,t.token=s,t}return n}(e,t,r);break;case"unary":n=yield*function*(e,t,r){var n;switch(e.value){case"-":if(void 0===(n=yield*c(e.expression,t,r)))n=void 0;else{if(!o(n))throw{code:"D1002",stack:(new Error).stack,position:e.position,token:e.value,value:n};n=-n}break;case"[":n=[];for(var i=0;i<e.expressions.length;i++){var a=e.expressions[i],s=yield*c(a,t,r);void 0!==s&&("["===a.value?n.push(s):n=N(n,s))}e.consarray&&Object.defineProperty(n,"cons",{enumerable:!1,configurable:!1,value:!0});break;case"{":n=yield*v(e,t,r)}return n}(e,t,r);break;case"name":n=h(e,t,r);break;case"string":case"number":case"value":n=function(e){return e.value}(e);break;case"wildcard":n=function(e,t){var r=f();null!==t&&"object"==typeof t&&Object.keys(t).forEach(function(e){var n=t[e];Array.isArray(n)?(n=function e(t,r){void 0===r&&(r=[]);Array.isArray(t)?t.forEach(function(t){e(t,r)}):r.push(t);return r}(n),r=N(r,n)):r.push(n)});return r}(0,t);break;case"descendant":n=function(e,t){var r,n=f();void 0!==t&&(!function e(t,r){Array.isArray(t)||r.push(t);Array.isArray(t)?t.forEach(function(t){e(t,r)}):null!==t&&"object"==typeof t&&Object.keys(t).forEach(function(n){e(t[n],r)})}(t,n),r=1===n.length?n[0]:n);return r}(0,t);break;case"condition":n=yield*function*(e,t,r){var n;M(yield*c(e.condition,t,r))?n=yield*c(e.then,t,r):void 0!==e.else&&(n=yield*c(e.else,t,r));return n}(e,t,r);break;case"block":n=yield*function*(e,t,r){for(var n,i=I(r),a=0;a<e.expressions.length;a++)n=yield*c(e.expressions[a],t,i);return n}(e,t,r);break;case"bind":n=yield*function*(e,t,r){var n=yield*c(e.rhs,t,r);return r.bind(e.lhs.value,n),n}(e,t,r);break;case"regex":n=function(e){var t=new RegExp(e.value),r=function(n){var i,a=t.exec(n);if(null!==a){if(i={match:a[0],start:a.index,end:a.index+a[0].length,groups:[]},a.length>1)for(var o=1;o<a.length;o++)i.groups.push(a[o]);i.next=function(){if(!(t.lastIndex>=n.length)){var i=r(n);if(i&&""===i.match)throw{code:"D1004",stack:(new Error).stack,position:e.position,value:e.value.source};return i}}}return i};return r}(e);break;case"function":n=yield*x(e,t,r);break;case"variable":n=function(e,t,r){var n;n=""===e.value?t:r.lookup(e.value);return n}(e,t,r);break;case"lambda":n=function(e,t,r){var n={_jsonata_lambda:!0,input:t,environment:r,arguments:e.arguments,signature:e.signature,body:e.body};!0===e.thunk&&(n.thunk=!0);return n}(e,t,r);break;case"partial":n=yield*function*(e,t,r){for(var n,i=[],a=0;a<e.arguments.length;a++){var o=e.arguments[a];"operator"===o.type&&"?"===o.value?i.push(o):i.push(yield*c(o,t,r))}var s=yield*c(e.procedure,t,r);if(void 0===s&&"path"===e.procedure.type&&r.lookup(e.procedure.steps[0].value))throw{code:"T1007",stack:(new Error).stack,position:e.position,token:e.procedure.steps[0].value};if(m(s))n=E(s,i);else if(s&&!0===s._jsonata_function)n=S(s.implementation,i);else{if("function"!=typeof s)throw{code:"T1008",stack:(new Error).stack,position:e.position,token:"path"===e.procedure.type?e.procedure.steps[0].value:e.procedure.value};n=S(s,i)}return n}(e,t,r);break;case"apply":n=yield*function*(e,t,r){var n;if("function"===e.rhs.type)e.rhs.arguments.unshift(e.lhs),n=yield*x(e.rhs,t,r),e.rhs.arguments.shift();else{var i=yield*c(e.lhs,t,r),a=yield*c(e.rhs,t,r);if(!b(a))throw{code:"T2006",stack:(new Error).stack,position:e.position,value:a};if(b(i)){var o=yield*c(y,null,r);n=yield*w(o,[i,a],null)}else n=yield*w(a,[i],null)}return n}(e,t,r);break;case"sort":n=yield*function*(e,t,r){var n=yield*c(e.lhs,t,r);return yield*F(n,function*(t,n){for(var i=0,a=0;0===i&&a<e.rhs.length;a++){var o=e.rhs[a],s=yield*c(o.expression,t,r),u=yield*c(o.expression,n,r),f=typeof s,l=typeof u;if("undefined"!==f)if("undefined"!==l){if("string"!==f&&"number"!==f||"string"!==l&&"number"!==l)throw{code:"T2008",stack:(new Error).stack,position:e.position,value:"string"!==f&&"number"!==f?s:u};if(f!==l)throw{code:"T2007",stack:(new Error).stack,position:e.position,value:s,value2:u};s!==u&&(i=s<u?-1:1,!0===o.descending&&(i=-i))}else i=-1;else i="undefined"===l?0:1}return 1===i})}(e,t,r);break;case"transform":n=function(e,t,r){return O(function*(t){if(void 0!==t){var n=r.lookup("clone");if(!b(n))throw{code:"T2013",stack:(new Error).stack,position:e.position};var i=yield*w(n,[t],null),a=yield*c(e.pattern,i,r);if(void 0!==a){Array.isArray(a)||(a=[a]);for(var o=0;o<a.length;o++){var u=a[o],f=yield*c(e.update,u,r),l=typeof f;if("undefined"!==l){if("object"!==l||null===f)throw{code:"T2011",stack:(new Error).stack,position:e.update.position,value:f};for(var p in f)u[p]=f[p]}if(void 0!==e.delete){var d=yield*c(e.delete,u,r);if(void 0!==d){var h=d;if(Array.isArray(d)||(d=[d]),!s(d))throw{code:"T2012",stack:(new Error).stack,position:e.delete.position,value:h};for(var v=0;v<d.length;v++)delete u[d[v]]}}}}return i}},"<(oa):o>")}(e,0,r)}!r.lookup("__jsonata_async")||void 0!==n&&null!==n&&"function"==typeof n.then||(n=Promise.resolve(n)),r.lookup("__jsonata_async")&&"function"==typeof n.then&&e.nextFunction&&"function"==typeof n[e.nextFunction]||(n=yield n),e.hasOwnProperty("predicate")&&(n=yield*function*(e,t,r){for(var n=t,i=f(),a=0;a<e.length;a++){var o=e[a];if(Array.isArray(n)||(n=f(n)),i=f(),"number"===o.type){var s=Math.floor(o.value);s<0&&(s=n.length+s),i=n[s]}else i=yield*d(o,n,r);n=i}return i}(e.predicate,n,r)),e.hasOwnProperty("group")&&(n=yield*v(e.group,n,r));var a=r.lookup("__evaluate_exit");return a&&a(e,t,r,n),n&&n.sequence&&(n=n.value()),n}function f(){var e=l([]);return 1===arguments.length&&e.push(arguments[0]),e}function l(e){return Object.defineProperty(e,"sequence",{enumerable:!1,configurable:!1,get:function(){return!0}}),Object.defineProperty(e,"keepSingleton",{enumerable:!1,configurable:!1,writable:!0,value:!1}),Object.defineProperty(e,"value",{enumerable:!1,configurable:!1,get:function(){return function(){switch(this.length){case 0:return;case 1:return this.keepSingleton?this:this[0];default:return this}}}}),e}function*p(e,t,r,n){for(var i=f(),a=0;a<t.length;a++){var o=yield*c(e,t[a],r);void 0!==o&&i.push(o)}var s=f();return n&&1===i.length&&Array.isArray(i[0])&&!i[0].sequence?s=i[0]:i.forEach(function(e){!Array.isArray(e)||e.cons||e.keepSingleton?s.push(e):Array.prototype.push.apply(s,e)}),s}function*d(e,t,r){for(var n=f(),i=0;i<t.length;i++){var a=t[i],s=yield*c(e,a,r);o(s)&&(s=[s]),u(s)?s.forEach(function(e){var r=Math.floor(e);r<0&&(r=t.length+r),r===i&&n.push(a)}):M(s)&&n.push(a)}return n}function h(e,t,r){var n;if(Array.isArray(t)){n=f();for(var i=0;i<t.length;i++){var a=h(e,t[i],r);void 0!==a&&n.push(a)}}else null!==t&&"object"==typeof t&&(n=t[e.value]);return n}function*v(e,t,r){var n={},i={};Array.isArray(t)||(t=f(t));for(var a=0;a<t.length;a++)for(var o=t[a],s=0;s<e.lhs.length;s++){var u=yield*c(e.lhs[s][0],o,r);if("string"!=typeof u)throw{code:"T1003",stack:(new Error).stack,position:e.position,value:u};var l={data:o,exprIndex:s};if(i.hasOwnProperty(u)){if(i[u].exprIndex!==s)throw{code:"D1009",stack:(new Error).stack,position:e.position,value:u};i[u].data=N(i[u].data,o)}else i[u]=l}for(u in i){l=i[u];var p=yield*c(e.lhs[l.exprIndex][1],l.data,r);void 0!==p&&(n[u]=p)}return n}function*g(e,t){var r=yield*w(e,[t],null);if(r&&"number"!=typeof r.start&&"number"!==r.end&&!Array.isArray(r.groups)&&!b(r.next))throw{code:"T1010",stack:(new Error).stack};return r}Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};var y=i("function($f, $g) { function($x){ $g($f($x)) } }");function b(e){return e&&(!0===e._jsonata_function||!0===e._jsonata_lambda)||"function"==typeof e}function m(e){return e&&!0===e._jsonata_lambda}function k(e){return"object"==typeof e&&null!==e&&Symbol.iterator in e&&"function"==typeof e[Symbol.iterator]&&"next"in e&&"function"==typeof e.next}function*x(e,t,r){var n,i=yield*c(e.procedure,t,r);if(void 0===i&&"path"===e.procedure.type&&r.lookup(e.procedure.steps[0].value))throw{code:"T1005",stack:(new Error).stack,position:e.position,token:e.procedure.steps[0].value};for(var a=[],o=0;o<e.arguments.length;o++)a.push(yield*c(e.arguments[o],t,r));try{n=yield*w(i,a,t)}catch(t){throw t.position=e.position,t.token="path"===e.procedure.type?e.procedure.steps[0].value:e.procedure.value,t}return n}function*w(e,t,r){var n;for(n=yield*A(e,t,r);m(n)&&!0===n.thunk;){for(var i=yield*c(n.body.procedure,n.input,n.environment),a=[],o=0;o<n.body.arguments.length;o++)a.push(yield*c(n.body.arguments[o],n.input,n.environment));n=yield*A(i,a,r)}return n}function*A(e,t,r){var n,i=t;if(e&&(i=function(e,t,r){if(void 0===e)return t;return e.validate(t,r)}(e.signature,t,r)),m(e))n=yield*function*(e,t){var r,n=I(e.environment);e.arguments.forEach(function(e,r){n.bind(e.value,t[r])}),r="function"==typeof e.body?yield*function*(e,t){var r=T(e).map(function(e){return t.lookup(e.trim())}),n=e.apply(null,r);k(n)&&(n=yield*n);return n}(e.body,n):yield*c(e.body,e.input,n);return r}(e,i);else if(e&&!0===e._jsonata_function)k(n=e.implementation.apply(r,i))&&(n=yield*n);else{if("function"!=typeof e)throw{code:"T1006",stack:(new Error).stack};k(n=e.apply(r,i))&&(n=yield*n)}return n}function E(e,t){var r=I(e.environment),n=[];return e.arguments.forEach(function(e,i){var a=t[i];a&&"operator"===a.type&&"?"===a.value?n.push(e):r.bind(e.value,a)}),{_jsonata_lambda:!0,input:e.input,environment:r,arguments:n,body:e.body}}function S(e,t){var r=T(e),n="function("+(r=r.map(function(e){return"$"+e.trim()})).join(", ")+"){ _ }",a=i(n);return a.body=e,E(a,t)}function T(e){var t=e.toString();return/\(([^)]*)\)/.exec(t)[1].split(",")}function O(e,t){var r={_jsonata_function:!0,implementation:e};return void 0!==t&&(r.signature=n(t)),r}function D(e){if(void 0!==e){var t;if("string"==typeof e)t=e;else if(b(e))t="";else{if("number"==typeof e&&!isFinite(e))throw{code:"D3001",value:e,stack:(new Error).stack};t=JSON.stringify(e,function(e,t){return void 0!==t&&null!==t&&t.toPrecision&&o(t)?Number(t.toPrecision(15)):t&&b(t)?"":t})}return t}}function j(e,t,r){if(void 0!==e){var n=Array.from(e),i=n.length;if(i+t<0&&(t=0),void 0!==r){if(r<=0)return"";var a=t>=0?t+r:i+t+r;return n.slice(t,a).join("")}return n.slice(t).join("")}}function P(e){if(void 0!==e)return Array.from(e).length}function _(e,t){var r;if(void 0!==e){if(t){var n=e.toString().split("e");e=+(n[0]+"e"+(n[1]?+n[1]+t:t))}var i=(r=Math.round(e))-e;return.5===Math.abs(i)&&1===Math.abs(r%2)&&(r-=1),t&&(r=+((n=r.toString().split("e"))[0]+"e"+(n[1]?+n[1]-t:-t))),Object.is(r,-0)&&(r=0),r}}function M(e){if(void 0!==e){var t=!1;if(Array.isArray(e)){if(1===e.length)t=M(e[0]);else if(e.length>1){t=e.filter(function(e){return M(e)}).length>0}}else"string"==typeof e?e.length>0&&(t=!0):o(e)?0!==e&&(t=!0):null!==e&&"object"==typeof e?Object.keys(e).length>0&&(m(e)||e._jsonata_function||(t=!0)):"boolean"==typeof e&&!0===e&&(t=!0);return t}}function N(e,t){return void 0===e?t:void 0===t?e:(Array.isArray(e)||(e=f(e)),Array.isArray(t)||(t=[t]),e.concat(t))}function*F(e,t){if(void 0!==e){if(e.length<=1)return e;var r;if(void 0===t){if(!u(e)&&!s(e))throw{stack:(new Error).stack,code:"D3070",index:1};r=function*(e,t){return e>t}}else r="function"==typeof t?t:function*(e,r){return yield*w(t,[e,r],null)};var n=function*(e){if(!Array.isArray(e)||e.length<=1)return e;var t=Math.floor(e.length/2),i=e.slice(0,t),a=e.slice(t);return yield*function*(e,t){var n=function*(e,t,i){0===t.length?Array.prototype.push.apply(e,i):0===i.length?Array.prototype.push.apply(e,t):(yield*r(t[0],i[0]))?(e.push(i[0]),yield*n(e,t,i.slice(1))):(e.push(t[0]),yield*n(e,t.slice(1),i))},i=[];return yield*n(i,e,t),i}(i=yield*n(i),a=yield*n(a))};return yield*n(e)}}var $=new RegExp("^\\d{4}(-[01]\\d)*(-[0-3]\\d)*(T[0-2]\\d:[0-5]\\d:[0-5]\\d)*(\\.\\d+)?([+-][0-2]\\d:?[0-5]\\d|Z)?$");function I(e){var t={};return{bind:function(e,r){t[e]=r},lookup:function(r){var n;return t.hasOwnProperty(r)?n=t[r]:e&&(n=e.lookup(r)),n}}}a.bind("sum",O(function(e){if(void 0!==e){var t=0;return e.forEach(function(e){t+=e}),t}},"<a<n>:n>")),a.bind("count",O(function(e){return void 0===e?0:e.length},"<a:n>")),a.bind("max",O(function(e){if(void 0!==e&&0!==e.length)return Math.max.apply(Math,e)},"<a<n>:n>")),a.bind("min",O(function(e){if(void 0!==e&&0!==e.length)return Math.min.apply(Math,e)},"<a<n>:n>")),a.bind("average",O(function(e){if(void 0!==e&&0!==e.length){var t=0;return e.forEach(function(e){t+=e}),t/e.length}},"<a<n>:n>")),a.bind("string",O(D,"<x-:s>")),a.bind("substring",O(j,"<s-nn?:s>")),a.bind("substringBefore",O(function(e,t){if(void 0!==e){var r=e.indexOf(t);return r>-1?e.substr(0,r):e}},"<s-s:s>")),a.bind("substringAfter",O(function(e,t){if(void 0!==e){var r=e.indexOf(t);return r>-1?e.substr(r+t.length):e}},"<s-s:s>")),a.bind("lowercase",O(function(e){if(void 0!==e)return e.toLowerCase()},"<s-:s>")),a.bind("uppercase",O(function(e){if(void 0!==e)return e.toUpperCase()},"<s-:s>")),a.bind("length",O(P,"<s-:n>")),a.bind("trim",O(function(e){if(void 0!==e){var t=e.replace(/[ \t\n\r]+/gm," ");return" "===t.charAt(0)&&(t=t.substring(1))," "===t.charAt(t.length-1)&&(t=t.substring(0,t.length-1)),t}},"<s-:s>")),a.bind("pad",O(function(e,t,r){if(void 0!==e){var n;void 0!==r&&0!==r.length||(r=" ");var i=Math.abs(t)-P(e);if(i>0){var a=new Array(i+1).join(r);r.length>1&&(a=j(a,0,i)),n=t>0?e+a:a+e}else n=e;return n}},"<s-ns?:s>")),a.bind("match",O(function*(e,t,r){if(void 0!==e){if(r<0)throw{stack:(new Error).stack,value:r,code:"D3040",index:3};var n=f();if(void 0===r||r>0){var i=0,a=yield*g(t,e);if(void 0!==a)for(;void 0!==a&&(void 0===r||i<r);)n.push({match:a.match,index:a.start,groups:a.groups}),a=yield*g(a.next),i++}return n}},"<s-f<s:o>n?:a<o>>")),a.bind("contains",O(function*(e,t){if(void 0!==e){return"string"==typeof t?-1!==e.indexOf(t):void 0!==(yield*g(t,e))}},"<s-(sf):b>")),a.bind("replace",O(function*(e,t,r,n){if(void 0!==e){if(""===t)throw{code:"D3010",stack:(new Error).stack,value:t,index:2};if(n<0)throw{code:"D3011",stack:(new Error).stack,value:n,index:4};var i;i="string"==typeof r?function(e){for(var t="",n=0,i=r.indexOf("$",n);-1!==i&&n<r.length;){t+=r.substring(n,i),n=i+1;var a=r.charAt(n);if("$"===a)t+="$",n++;else if("0"===a)t+=e.match,n++;else{var o;if(o=0===e.groups.length?1:Math.floor(Math.log(e.groups.length)*Math.LOG10E)+1,i=parseInt(r.substring(n,n+o),10),o>1&&i>e.groups.length&&(i=parseInt(r.substring(n,n+o-1),10)),isNaN(i))t+="$";else{if(e.groups.length>0){var s=e.groups[i-1];void 0!==s&&(t+=s)}n+=i.toString().length}}i=r.indexOf("$",n)}return t+=r.substring(n)}:r;var a="",o=0;if(void 0===n||n>0){var s=0;if("string"==typeof t){for(var u=e.indexOf(t,o);-1!==u&&(void 0===n||s<n);)a+=e.substring(o,u),a+=r,o=u+t.length,s++,u=e.indexOf(t,o);a+=e.substring(o)}else{var c=yield*g(t,e);if(void 0!==c){for(;void 0!==c&&(void 0===n||s<n);){a+=e.substring(o,c.start);var f=yield*w(i,[c],null);if("string"!=typeof f)throw{code:"D3012",stack:(new Error).stack,value:f};a+=f,o=c.start+c.match.length,s++,c=yield*g(c.next)}a+=e.substring(o)}else a=e}}else a=e;return a}},"<s-(sf)(sf)n?:s>")),a.bind("split",O(function*(e,t,r){if(void 0!==e){if(r<0)throw{code:"D3020",stack:(new Error).stack,value:r,index:3};var n=[];if(void 0===r||r>0)if("string"==typeof t)n=e.split(t,r);else{var i=0,a=yield*g(t,e);if(void 0!==a){for(var o=0;void 0!==a&&(void 0===r||i<r);)n.push(e.substring(o,a.start)),o=a.end,a=yield*g(a.next),i++;(void 0===r||i<r)&&n.push(e.substring(o))}else n.push(e)}return n}},"<s-(sf)n?:a<s>>")),a.bind("join",O(function(e,t){if(void 0!==e)return void 0===t&&(t=""),e.join(t)},"<a<s>s?:s>")),a.bind("formatNumber",O(function(e,t,r){if(void 0!==e){var n={"decimal-separator":".","grouping-separator":",","exponent-separator":"e",infinity:"Infinity","minus-sign":"-",NaN:"NaN",percent:"%","per-mille":"â°","zero-digit":"0",digit:"#","pattern-separator":";"};void 0!==r&&Object.keys(r).forEach(function(e){n[e]=r[e]});for(var i=[],a=n["zero-digit"].charCodeAt(0),o=a;o<a+10;o++)i.push(String.fromCharCode(o));var s=i.concat([n["decimal-separator"],n["exponent-separator"],n["grouping-separator"],n.digit,n["pattern-separator"]]),u=t.split(n["pattern-separator"]);if(u.length>2)throw{code:"D3080",stack:(new Error).stack};var c=u.map(function(e){var t,r,i,a,o=function(){for(var t,r=0;r<e.length;r++)if(t=e.charAt(r),-1!==s.indexOf(t)&&t!==n["exponent-separator"])return e.substring(0,r)}(),u=function(){for(var t,r=e.length-1;r>=0;r--)if(t=e.charAt(r),-1!==s.indexOf(t)&&t!==n["exponent-separator"])return e.substring(r+1)}(),c=e.substring(o.length,e.length-u.length),f=e.indexOf(n["exponent-separator"],o.length);-1===f||f>e.length-u.length?(t=c,r=void 0):(t=c.substring(0,f),r=c.substring(f+1));var l=t.indexOf(n["decimal-separator"]);return-1===l?(i=t,a=u):(i=t.substring(0,l),a=t.substring(l+1)),{prefix:o,suffix:u,activePart:c,mantissaPart:t,exponentPart:r,integerPart:i,fractionalPart:a,subpicture:e}});c.forEach(function(e){var t,r,a=e.subpicture,o=a.indexOf(n["decimal-separator"]);o!==a.lastIndexOf(n["decimal-separator"])&&(t="D3081"),a.indexOf(n.percent)!==a.lastIndexOf(n.percent)&&(t="D3082"),a.indexOf(n["per-mille"])!==a.lastIndexOf(n["per-mille"])&&(t="D3083"),-1!==a.indexOf(n.percent)&&-1!==a.indexOf(n["per-mille"])&&(t="D3084");var u=!1;for(r=0;r<e.mantissaPart.length;r++){var c=e.mantissaPart.charAt(r);if(-1!==i.indexOf(c)||c===n.digit){u=!0;break}}u||(t="D3085"),-1!==e.activePart.split("").map(function(e){return-1===s.indexOf(e)?"p":"a"}).join("").indexOf("p")&&(t="D3086"),-1!==o?a.charAt(o-1)!==n["grouping-separator"]&&a.charAt(o+1)!==n["grouping-separator"]||(t="D3087"):e.integerPart.charAt(e.integerPart.length-1)===n["grouping-separator"]&&(t="D3088"),-1!==a.indexOf(n["grouping-separator"]+n["grouping-separator"])&&(t="D3089");var f=e.integerPart.indexOf(n.digit);-1!==f&&e.integerPart.substring(0,f).split("").filter(function(e){return i.indexOf(e)>-1}).length>0&&(t="D3090"),-1!==(f=e.fractionalPart.lastIndexOf(n.digit))&&e.fractionalPart.substring(f).split("").filter(function(e){return i.indexOf(e)>-1}).length>0&&(t="D3091");var l="string"==typeof e.exponentPart;if(l&&e.exponentPart.length>0&&(-1!==a.indexOf(n.percent)||-1!==a.indexOf(n["per-mille"]))&&(t="D3092"),l&&(0===e.exponentPart.length||e.exponentPart.split("").filter(function(e){return-1===i.indexOf(e)}).length>0)&&(t="D3093"),t)throw{code:t,stack:(new Error).stack}});var f,l,p,d,h=c.map(function(e){var t=function(t,r){for(var a=[],o=t.indexOf(n["grouping-separator"]);-1!==o;){var s=(r?t.substring(0,o):t.substring(o)).split("").filter(function(e){return-1!==i.indexOf(e)||e===n.digit}).length;a.push(s),o=e.integerPart.indexOf(n["grouping-separator"],o+1)}return a},r=t(e.integerPart),a=function(e){if(0===e.length)return 0;for(var t=function(e,r){return 0===r?e:t(r,e%r)},r=e.reduce(t),n=1;n<=e.length;n++)if(-1===e.indexOf(n*r))return 0;return r}(r),o=t(e.fractionalPart,!0),s=e.integerPart.split("").filter(function(e){return-1!==i.indexOf(e)}).length,u=s,c=e.fractionalPart.split(""),f=c.filter(function(e){return-1!==i.indexOf(e)}).length,l=c.filter(function(e){return-1!==i.indexOf(e)||e===n.digit}).length,p="string"==typeof e.exponentPart;0===s&&0===l&&(p?(f=1,l=1):s=1),p&&0===s&&-1!==e.integerPart.indexOf(n.digit)&&(s=1),0===s&&0===f&&(f=1);var d=0;return p&&(d=e.exponentPart.split("").filter(function(e){return-1!==i.indexOf(e)}).length),{integerPartGroupingPositions:r,regularGrouping:a,minimumIntegerPartSize:s,scalingFactor:u,prefix:e.prefix,fractionalPartGroupingPositions:o,minimumFactionalPartSize:f,maximumFactionalPartSize:l,minimumExponentSize:d,suffix:e.suffix,picture:e.subpicture}}),v=n["minus-sign"],g=n["zero-digit"],y=n["decimal-separator"],b=n["grouping-separator"];if(1===h.length&&(h.push(JSON.parse(JSON.stringify(h[0]))),h[1].prefix=v+h[1].prefix),l=-1!==(f=e>=0?h[0]:h[1]).picture.indexOf(n.percent)?100*e:-1!==f.picture.indexOf(n["per-mille"])?1e3*e:e,0===f.minimumExponentSize)p=l;else{var m=Math.pow(10,f.scalingFactor),k=Math.pow(10,f.scalingFactor-1);for(p=l,d=0;p<k;)p*=10,d-=1;for(;p>m;)p/=10,d+=1}var x=function(e,t){var r=Math.abs(e).toFixed(t);return"0"!==g&&(r=r.split("").map(function(e){return e>="0"&&e<="9"?i[e.charCodeAt(0)-48]:e}).join("")),r},w=x(_(p,f.maximumFactionalPartSize),f.maximumFactionalPartSize),A=w.indexOf(".");for(-1===A?w+=y:w=w.replace(".",y);w.charAt(0)===g;)w=w.substring(1);for(;w.charAt(w.length-1)===g;)w=w.substring(0,w.length-1);A=w.indexOf(y);var E=f.minimumIntegerPartSize-A,S=f.minimumFactionalPartSize-(w.length-A-1);if(w=(E>0?new Array(E+1).join(g):"")+w,w+=S>0?new Array(S+1).join(g):"",A=w.indexOf(y),f.regularGrouping>0)for(var T=Math.floor((A-1)/f.regularGrouping),O=1;O<=T;O++)w=[w.slice(0,A-O*f.regularGrouping),b,w.slice(A-O*f.regularGrouping)].join("");else f.integerPartGroupingPositions.forEach(function(e){w=[w.slice(0,A-e),b,w.slice(A-e)].join(""),A++});if(A=w.indexOf(y),f.fractionalPartGroupingPositions.forEach(function(e){w=[w.slice(0,e+A+1),b,w.slice(e+A+1)].join("")}),A=w.indexOf(y),-1!==f.picture.indexOf(y)&&A!==w.length-1||(w=w.substring(0,w.length-1)),void 0!==d){var D=x(d,0);(E=f.minimumExponentSize-D.length)>0&&(D=new Array(E+1).join(g)+D),w=w+n["exponent-separator"]+(d<0?v:"")+D}return w=f.prefix+w+f.suffix}},"<n-so?:s>")),a.bind("formatBase",O(function(e,t){if(void 0!==e){if(e=_(e),(t=void 0===t?10:_(t))<2||t>36)throw{code:"D3100",stack:(new Error).stack,value:t};return e.toString(t)}},"<n-n?:s>")),a.bind("number",O(function(e){var t;if(void 0!==e){if("number"==typeof e)t=e;else{if("string"!=typeof e||!/^-?(0|([1-9][0-9]*))(\.[0-9]+)?([Ee][-+]?[0-9]+)?$/.test(e)||isNaN(parseFloat(e))||!isFinite(e))throw{code:"D3030",value:e,stack:(new Error).stack,index:1};t=parseFloat(e)}return t}},"<(ns)-:n>")),a.bind("floor",O(function(e){if(void 0!==e)return Math.floor(e)},"<n-:n>")),a.bind("ceil",O(function(e){if(void 0!==e)return Math.ceil(e)},"<n-:n>")),a.bind("round",O(_,"<n-n?:n>")),a.bind("abs",O(function(e){if(void 0!==e)return Math.abs(e)},"<n-:n>")),a.bind("sqrt",O(function(e){if(void 0!==e){if(e<0)throw{stack:(new Error).stack,code:"D3060",index:1,value:e};return Math.sqrt(e)}},"<n-:n>")),a.bind("power",O(function(e,t){var r;if(void 0!==e){if(r=Math.pow(e,t),!isFinite(r))throw{stack:(new Error).stack,code:"D3061",index:1,value:e,exp:t};return r}},"<n-n:n>")),a.bind("random",O(function(){return Math.random()},"<:n>")),a.bind("boolean",O(M,"<x-:b>")),a.bind("not",O(function(e){return!M(e)},"<x-:b>")),a.bind("map",O(function*(e,t){if(void 0!==e){for(var r=f(),n=0;n<e.length;n++){var i=[e[n]],a="function"==typeof t?t.length:!0===t._jsonata_function?t.implementation.length:t.arguments.length;a>=2&&i.push(n),a>=3&&i.push(e);var o=yield*w(t,i,null);void 0!==o&&r.push(o)}return r}},"<af>")),a.bind("zip",O(function(){for(var e=[],t=Array.prototype.slice.call(arguments),r=Math.min.apply(Math,t.map(function(e){return Array.isArray(e)?e.length:0})),n=0;n<r;n++){var i=t.map(e=>e[n]);e.push(i)}return e},"<a+>")),a.bind("filter",O(function*(e,t){if(void 0!==e){for(var r=f(),n=0;n<e.length;n++){var i=e[n];M(yield*w(t,[i,n,e],null))&&r.push(i)}return r}},"<af>")),a.bind("reduce",O(function*(e,t,r){if(void 0!==e){var n,i;if(2!==t.length&&(!0!==t._jsonata_function||2!==t.implementation.length)&&2!==t.arguments.length)throw{stack:(new Error).stack,code:"D3050",index:1};for(void 0===r&&e.length>0?(n=e[0],i=1):(n=r,i=0);i<e.length;)n=yield*w(t,[n,e[i]],null),i++;return n}},"<afj?:j>")),a.bind("sift",O(function*(e,t){var r={};for(var n in e){var i=e[n];M(yield*w(t,[i,n,e],null))&&(r[n]=i)}return 0===Object.keys(r).length&&(r=void 0),r},"<o-f?:o>")),a.bind("keys",O(function e(t){var r=f();if(Array.isArray(t)){var n={};t.forEach(function(t){var r=e(t);Array.isArray(r)&&r.forEach(function(e){n[e]=!0})}),r=e(n)}else null===t||"object"!=typeof t||m(t)?r=void 0:0===(r=Object.keys(t)).length&&(r=void 0);return r},"<x-:a<s>>")),a.bind("lookup",O(function(e,t){return h({value:t},e)},"<x-s:x>")),a.bind("append",O(N,"<xx:a>")),a.bind("exists",O(function(e){return void 0!==e},"<x:b>")),a.bind("spread",O(function e(t){var r=f();if(Array.isArray(t))t.forEach(function(t){r=N(r,e(t))});else if(null===t||"object"!=typeof t||m(t))r=t;else for(var n in t){var i={};i[n]=t[n],r.push(i)}return r},"<x-:a<o>>")),a.bind("merge",O(function(e){if(void 0!==e){var t={};return e.forEach(function(e){for(var r in e)t[r]=e[r]}),t}},"<a<o>:o>")),a.bind("reverse",O(function(e){if(void 0!==e){if(e.length<=1)return e;for(var t=e.length,r=new Array(t),n=0;n<t;n++)r[t-n-1]=e[n];return r}},"<a:a>")),a.bind("each",O(function*(e,t){var r=f();for(var n in e){var i=[e[n],n];r.push(yield*w(t,i,null))}return r},"<o-f:a>")),a.bind("sort",O(F,"<af?:a>")),a.bind("shuffle",O(function(e){if(void 0!==e){if(e.length<=1)return e;for(var t=new Array(e.length),r=0;r<e.length;r++){var n=Math.floor(Math.random()*(r+1));r!==n&&(t[r]=t[n]),t[n]=e[r]}return t}},"<a:a>")),a.bind("base64encode",O(function(e){if(void 0!==e)return("undefined"!=typeof window?window.btoa:function(e){return new global.Buffer(e,"binary").toString("base64")})(e)},"<s-:s>")),a.bind("base64decode",O(function(e){if(void 0!==e)return("undefined"!=typeof window?window.atob:function(e){return new global.Buffer(e,"base64").toString("binary")})(e)},"<s-:s>")),a.bind("toMillis",O(function(e){if(void 0!==e){if(!$.test(e))throw{stack:(new Error).stack,code:"D3110",value:e};return Date.parse(e)}},"<s-:n>")),a.bind("fromMillis",O(function(e){if(void 0!==e)return new Date(e).toISOString()},"<n-:s>")),a.bind("clone",O(function(e){if(void 0!==e)return JSON.parse(D(e))},"<(oa)-:o>"));var z={S0101:"String literal must be terminated by a matching quote",S0102:"Number out of range: {{token}}",S0103:"Unsupported escape sequence: \\{{token}}",S0104:"The escape sequence \\u must be followed by 4 hex digits",S0105:"Quoted property name must be terminated with a backquote (`)",S0201:"Syntax error: {{token}}",S0202:"Expected {{value}}, got {{token}}",S0203:"Expected {{value}} before end of expression",S0204:"Unknown operator: {{token}}",S0205:"Unexpected token: {{token}}",S0206:"Unknown expression type: {{token}}",S0207:"Unexpected end of expression",S0208:"Parameter {{value}} of function definition must be a variable name (start with $)",S0209:"A predicate cannot follow a grouping expression in a step",S0210:"Each step can only have one grouping expression",S0211:"The symbol {{token}} cannot be used as a unary operator",S0212:"The left side of := must be a variable name (start with $)",S0213:"The literal value {{value}} cannot be used as a step within a path expression",S0301:"Empty regular expressions are not allowed",S0302:"No terminating / in regular expression",S0402:"Choice groups containing parameterized types are not supported",S0401:"Type parameters can only be applied to functions and arrays",S0500:"Attempted to evaluate an expression containing syntax error(s)",T0410:"Argument {{index}} of function {{token}} does not match function signature",T0411:"Context value is not a compatible type with argument {{index}} of function {{token}}",T0412:"Argument {{index}} of function {{token}} must be an array of {{type}}",D1001:"Number out of range: {{value}}",D1002:"Cannot negate a non-numeric value: {{value}}",T1003:"Key in object structure must evaluate to a string; got: {{value}}",D1004:"Regular expression matches zero length string",T1005:"Attempted to invoke a non-function. Did you mean ${{{token}}}?",T1006:"Attempted to invoke a non-function",T1007:"Attempted to partially apply a non-function. Did you mean ${{{token}}}?",T1008:"Attempted to partially apply a non-function",D1009:"Multiple key definitions evaluate to same key: {{value}}",T1010:"The matcher function argument passed to function {{token}} does not return the correct object structure",T2001:"The left side of the {{token}} operator must evaluate to a number",T2002:"The right side of the {{token}} operator must evaluate to a number",T2003:"The left side of the range operator (..) must evaluate to an integer",T2004:"The right side of the range operator (..) must evaluate to an integer",D2005:"The left side of := must be a variable name (start with $)",T2006:"The right side of the function application operator ~> must be a function",T2007:"Type mismatch when comparing values {{value}} and {{value2}} in order-by clause",T2008:"The expressions within an order-by clause must evaluate to numeric or string values",T2009:"The values {{value}} and {{value2}} either side of operator {{token}} must be of the same data type",T2010:"The expressions either side of operator {{token}} must evaluate to numeric or string values",T2011:"The insert/update clause of the transform expression must evaluate to an object: {{value}}",T2012:"The delete clause of the transform expression must evaluate to a string or array of strings: {{value}}",T2013:"The transform expression clones the input object using the $clone() function.  This has been overridden in the current scope by a non-function.",D3001:"Attempting to invoke string function on Infinity or NaN",D3010:"Second argument of replace function cannot be an empty string",D3011:"Fourth argument of replace function must evaluate to a positive number",D3012:"Attempted to replace a matched string with a non-string value",D3020:"Third argument of split function must evaluate to a positive number",D3030:"Unable to cast value to a number: {{value}}",D3040:"Third argument of match function must evaluate to a positive number",D3050:"First argument of reduce function must be a function with two arguments",D3060:"The sqrt function cannot be applied to a negative number: {{value}}",D3061:"The power function has resulted in a value that cannot be represented as a JSON number: base={{value}}, exponent={{exp}}",D3070:"The single argument form of the sort function can only be applied to an array of strings or an array of numbers.  Use the second argument to specify a comparison function",D3080:"The picture string must only contain a maximum of two sub-pictures",D3081:"The sub-picture must not contain more than one instance of the 'decimal-separator' character",D3082:"The sub-picture must not contain more than one instance of the 'percent' character",D3083:"The sub-picture must not contain more than one instance of the 'per-mille' character",D3084:"The sub-picture must not contain both a 'percent' and a 'per-mille' character",D3085:"The mantissa part of a sub-picture must contain at least one character that is either an 'optional digit character' or a member of the 'decimal digit family'",D3086:"The sub-picture must not contain a passive character that is preceded by an active character and that is followed by another active character",D3087:"The sub-picture must not contain a 'grouping-separator' character that appears adjacent to a 'decimal-separator' character",D3088:"The sub-picture must not contain a 'grouping-separator' at the end of the integer part",D3089:"The sub-picture must not contain two adjacent instances of the 'grouping-separator' character",D3090:"The integer part of the sub-picture must not contain a member of the 'decimal digit family' that is followed by an instance of the 'optional digit character'",D3091:"The fractional part of the sub-picture must not contain an instance of the 'optional digit character' that is followed by a member of the 'decimal digit family'",D3092:"A sub-picture that contains a 'percent' or 'per-mille' character must not contain a character treated as an 'exponent-separator'",D3093:"The exponent part of the sub-picture must comprise only of one or more characters that are members of the 'decimal digit family'",D3100:"The radix of the formatBase function must be between 2 and 36.  It was given {{value}}",D3110:"The argument of the toMillis function must be an ISO 8601 formatted timestamp. Given {{value}}"};function C(e){var t="Unknown error";void 0!==e.message&&(t=e.message);var r=z[e.code];return void 0!==r&&(t=(t=r.replace(/\{\{\{([^}]+)}}}/g,function(){return e[arguments[1]]})).replace(/\{\{([^}]+)}}/g,function(){return JSON.stringify(e[arguments[1]])})),t}function G(e,t){var r,n;try{r=i(e,t&&t.recover),n=r.errors,delete r.errors}catch(e){throw e.message=C(e),e}var o=I(a),s=new Date;return o.bind("now",O(function(){return s.toJSON()},"<:s>")),o.bind("millis",O(function(){return s.getTime()},"<:n>")),{evaluate:function(e,t,i){if(void 0!==n){var a={code:"S0500",position:0};throw a.message=C(a),a}var u,f,l;if(void 0!==t)for(var p in u=I(o),t)u.bind(p,t[p]);else u=o;if(u.bind("$",e),s=new Date,"function"==typeof i){u.bind("__jsonata_async",!0);var d=function(e){e.message=C(e),i(e,null)},h=function(e){(f=l.next(e)).done?i(null,f.value):f.value.then(h).catch(d)};l=c(r,e,u),(f=l.next()).value.then(h).catch(d)}else try{for(l=c(r,e,u),f=l.next();!f.done;)f=l.next(f.value);return f.value}catch(a){throw a.message=C(a),a}},assign:function(e,t){o.bind(e,t)},registerFunction:function(e,t,r){var n=O(t,r);o.bind(e,n)},ast:function(){return r},errors:function(){return n}}}return G.parser=i,G}();"undefined"!=typeof module&&(module.exports=jsonata);